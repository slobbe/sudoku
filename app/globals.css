@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  color-scheme: light;
  --font-heading: "Iowan Old Style", "Palatino Linotype", "Book Antiqua", Palatino, Georgia, "Times New Roman", serif;
  --font-ui: "IBM Plex Sans", "Avenir Next", "Segoe UI", Inter, "Helvetica Neue", Arial, sans-serif;

  --ui-background: 42 36% 95%;
  --ui-foreground: 30 17% 16%;
  --ui-card: 40 33% 98%;
  --ui-card-foreground: 30 17% 16%;
  --ui-popover: 40 33% 98%;
  --ui-popover-foreground: 30 17% 16%;
  --ui-primary: 260 34% 50%;
  --ui-primary-foreground: 36 33% 98%;
  --ui-secondary: 36 21% 91%;
  --ui-secondary-foreground: 30 16% 20%;
  --ui-muted: 36 17% 89%;
  --ui-muted-foreground: 30 10% 42%;
  --ui-accent: 262 29% 91%;
  --ui-accent-foreground: 258 27% 28%;
  --ui-destructive: 6 45% 46%;
  --ui-destructive-foreground: 0 0% 100%;
  --ui-border: 34 16% 80%;
  --ui-input: 34 16% 80%;
  --ui-ring: 260 34% 50%;
  --ui-radius: 0.7rem;

  --paper: #f5f1e8;
  --ink: #2f2922;
  --soft-ink: #655f58;
  --line: #c8c0b3;
  --line-strong: #ab9f8c;
  --surface: #faf7f1;
  --surface-2: #f0eae0;
  --surface-3: #ece4d8;
  --accent: hsl(260 40% 55%);
  --accent-soft: hsl(260 54% 94%);
  --error: #b35f56;
  --app-vh: 1vh;
}

:root[data-theme="dark"] {
  color-scheme: dark;
  --ui-background: 30 11% 9%;
  --ui-foreground: 40 16% 91%;
  --ui-card: 30 10% 12%;
  --ui-card-foreground: 40 16% 91%;
  --ui-popover: 30 10% 12%;
  --ui-popover-foreground: 40 16% 91%;
  --ui-primary: 262 48% 66%;
  --ui-primary-foreground: 30 14% 10%;
  --ui-secondary: 30 8% 16%;
  --ui-secondary-foreground: 40 16% 88%;
  --ui-muted: 30 7% 16%;
  --ui-muted-foreground: 35 11% 67%;
  --ui-accent: 262 26% 22%;
  --ui-accent-foreground: 40 18% 92%;
  --ui-destructive: 6 39% 56%;
  --ui-destructive-foreground: 0 0% 100%;
  --ui-border: 30 8% 24%;
  --ui-input: 30 8% 24%;
  --ui-ring: 262 48% 66%;

  --paper: #141311;
  --ink: #e8e0d2;
  --soft-ink: #b7ab99;
  --line: #443e35;
  --line-strong: #5d5346;
  --surface: #1a1815;
  --surface-2: #1f1c19;
  --surface-3: #24211d;
  --accent: hsl(262 52% 67%);
  --accent-soft: hsl(262 24% 23%);
  --error: #cf8a82;
}

* {
  box-sizing: border-box;
}

html,
body {
  scrollbar-gutter: stable;
}

html {
  min-height: 100%;
  background: var(--paper);
}

body {
  margin: 0;
  min-height: 100svh;
  font-family: var(--font-ui);
  line-height: 1.45;
  color: var(--ink);
  background:
    radial-gradient(circle at 12% -8%, color-mix(in srgb, var(--accent) 8%, transparent), transparent 42%),
    linear-gradient(180deg, color-mix(in srgb, var(--paper) 92%, white 8%) 0%, var(--paper) 100%);
  text-rendering: geometricPrecision;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

:root[data-scroll-lock="on"],
:root[data-scroll-lock="on"] body {
  overscroll-behavior: none;
}

a {
  color: inherit;
}

h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: var(--font-heading);
  color: var(--ink);
}

input,
select,
textarea {
  font: inherit;
}

.app {
  width: min(100%, 72rem);
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.app.app-home,
.app.app-panel,
.app.app-game {
  padding: 1rem;
}

.app.app-home,
.app.app-panel {
  max-width: 56rem;
}

.app.app-game {
  max-width: 42rem;
}

.home-view,
.panel-view {
  display: grid;
  gap: 1rem;
  padding: 0.8rem 0;
}

.home-view {
  grid-template-rows: auto auto auto;
}

.view-title {
  margin: 0;
  text-align: center;
  font-family: var(--font-heading);
  font-size: clamp(2rem, 7vw, 2.7rem);
  letter-spacing: 0.01em;
}

.home-actions {
  display: grid;
  gap: 0.65rem;
}

.home-primary-actions {
  display: grid;
  gap: 0.65rem;
}

@media (min-width: 640px) {
  .home-primary-actions {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

.home-bottom-bar {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 0.65rem;
}

.home-bottom-bar button,
.home-actions button {
  min-height: 2.8rem;
}

.looks-disabled {
  opacity: 0.72;
}

.home-status,
.home-profile-status {
  margin: 0;
  text-align: center;
  color: var(--soft-ink);
  font-size: 0.86rem;
}

.board-wrap {
  display: grid;
  min-height: 0;
}

.board-area {
  display: grid;
  width: 100%;
  justify-items: center;
  align-items: center;
}

.game-layout {
  width: 100%;
  max-width: 34rem;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 0.65rem;
}

.game-center {
  width: 100%;
  max-width: 33rem;
  order: 1;
  display: grid;
  gap: 0.6rem;
}

.game-rail {
  width: 100%;
  max-width: 33rem;
  padding: 0.2rem 0;
  display: grid;
  gap: 0.22rem;
}

.game-rail-left {
  order: 2;
  grid-template-columns: repeat(5, minmax(0, 1fr));
}

.game-rail-left #undo {
  order: 1;
}

.game-rail-left #redo {
  order: 2;
}

.game-rail-left #lives {
  order: 3;
}

.game-rail-left #annotation-mode {
  order: 4;
}

.game-rail-left #hint {
  order: 5;
}

.game-rail-right {
  order: 3;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  align-items: center;
}

.game-rail-left button,
.game-rail-right button,
.game-rail-right [data-state] {
  min-height: 2rem;
}

.game-rail-label {
  margin: 0;
  grid-column: 1 / -1;
  font-size: 0.72rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--soft-ink);
}

.icon-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
}

.icon-button svg {
  width: 1.05rem;
  height: 1.05rem;
}

.icon-button.has-count {
  gap: 0.4rem;
}

.game-rail .icon-button {
  min-height: 2rem;
}

.game-rail .icon-button:not(.has-count):not(.with-label) {
  width: 2rem;
  height: 2rem;
  padding: 0;
}

.game-rail .icon-button.has-count {
  width: 2rem;
  height: 2rem;
  min-height: 2rem;
  padding: 0;
}

.game-rail .icon-button svg {
  width: 0.82rem;
  height: 0.82rem;
}

.game-secondary-actions {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 0.22rem;
}

.daily-quick-actions {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 0.22rem;
}

.game-secondary-actions .icon-button.with-label {
  width: 100%;
  height: 2rem;
  min-height: 2rem;
  padding-inline: 0.42rem;
  justify-content: center;
  gap: 0.28rem;
  font-size: 0.7rem;
}

.game-secondary-actions .icon-button.with-label svg {
  width: 0.78rem;
  height: 0.78rem;
}

.game-secondary-actions .daily-date-trigger {
  width: 100%;
  min-height: 2rem;
  padding-inline: 0.42rem;
  justify-content: center;
  gap: 0.22rem;
  font-size: 0.7rem;
}

.game-secondary-actions .daily-date-label {
  max-width: 6.4rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.lives {
  margin: 0;
  min-width: 2rem;
  width: 2rem;
  height: 2rem;
  padding: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

#lives-display {
  display: inline-flex;
  align-items: center;
  flex-direction: column;
  gap: 0.06rem;
}

.lives-heart,
.lives-miss {
  width: 0.72rem;
  height: 0.72rem;
}

.lives-miss {
  opacity: 0.5;
}

.lives.empty {
  color: var(--error);
}

.numpad {
  display: grid;
  grid-template-columns: repeat(9, minmax(0, 1fr));
  gap: 0.35rem;
}

.numpad button {
  min-height: clamp(2.65rem, 6.5svh, 3.1rem);
  border: 1px solid var(--line);
  border-radius: 0.55rem;
  background: var(--surface);
  color: var(--ink);
  font-weight: 700;
  font-size: clamp(1rem, 4.1vw, 1.2rem);
  font-variant-numeric: tabular-nums;
  transition: background-color 150ms ease, border-color 150ms ease, color 150ms ease;
}

.numpad button:hover {
  border-color: var(--line-strong);
  background: var(--surface-2);
}

.numpad button:disabled {
  opacity: 0.4;
}

.numpad button.fill-mode,
.numpad button.annotation-mode,
#annotation-mode.annotation-enabled {
  background: var(--accent-soft);
  border-color: color-mix(in srgb, var(--accent) 55%, var(--line));
  color: color-mix(in srgb, var(--accent) 48%, var(--ink));
}

.hint-count {
  min-width: 1.4rem;
  height: 1.4rem;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 0.78rem;
  background: color-mix(in srgb, var(--accent-soft) 70%, var(--surface));
  color: var(--ink);
}

.difficulty-segment {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 0.35rem;
  margin-top: 0.1rem;
}

.difficulty-segment button {
  min-height: 2rem;
}

.difficulty-current {
  margin: 0;
  min-height: 2rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.28rem;
  color: var(--soft-ink);
  font-size: 0.8rem;
}

.difficulty-current span {
  color: var(--ink);
  font-weight: 600;
}

.daily-date-trigger {
  width: 100%;
  justify-content: space-between;
  min-height: 2rem;
}

.daily-date-label {
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.daily-date-content .rdp {
  margin: 0;
}

.game-rail-right .difficulty-segment,
.game-rail-right .difficulty-current,
.game-rail-right > .daily-date-trigger {
  grid-column: 1 / -1;
}

.game-rail-left .hint-count {
  display: none;
}

.pwa-board-theme {
  --sudoku-font-family: var(--font-ui);
  --sudoku-board-border-color: var(--line-strong);
  --sudoku-board-border-width: 1.5px;
  --sudoku-board-border-radius: 12px;
  --sudoku-square-gap: 2px;
  --sudoku-square-divider-color: var(--line);
  --sudoku-cell-gap: 1px;
  --sudoku-cell-bg: color-mix(in srgb, var(--surface) 94%, white 6%);
  --sudoku-cell-bg-alt: color-mix(in srgb, var(--surface-2) 92%, white 8%);
  --sudoku-cell-ink: var(--ink);
  --sudoku-cell-font-size: clamp(1rem, 5.4cqi, 2rem);
  --sudoku-cell-font-weight: 760;
  --sudoku-given-bg: color-mix(in srgb, var(--surface-2) 92%, var(--accent-soft));
  --sudoku-given-ink: var(--ink);
  --sudoku-selected-bg: color-mix(in srgb, var(--accent-soft) 70%, transparent);
  --sudoku-selected-ring: color-mix(in srgb, var(--accent) 58%, transparent);
  --sudoku-selected-ring-width: 2px;
  --sudoku-active-bg: var(--sudoku-selected-bg);
  --sudoku-active-ring: var(--sudoku-selected-ring);
  --sudoku-match-bg: color-mix(in srgb, var(--accent-soft) 55%, transparent);
  --sudoku-match-ink: var(--ink);
  --sudoku-match-ring: transparent;
  --sudoku-match-ring-width: 0;
  --sudoku-match-font-weight: 760;
  --sudoku-match-scale: 1;
  --sudoku-invalid-ink: var(--error);
  --sudoku-focus-ring: color-mix(in srgb, var(--accent) 66%, var(--line));
  --sudoku-note-ink: var(--soft-ink);
  --sudoku-note-font-size: clamp(0.5rem, 2.45cqi, 0.84rem);
  --sudoku-note-font-weight: 560;
  --sudoku-note-highlight-scale: 1.15;
  --sudoku-note-highlight-ink: color-mix(in srgb, var(--accent) 44%, var(--ink));
  --sudoku-selected-note-ink: color-mix(in srgb, var(--accent) 40%, var(--ink));
  --sudoku-cell-transition: background 150ms ease, box-shadow 150ms ease, color 150ms ease;
}

.settings-view,
.stats-view,
.profile-view {
  min-height: 0;
}

.account-layout {
  display: grid;
  gap: 0.8rem;
}

.account-sidebar {
  padding: 0.3rem 0;
  display: grid;
  gap: 0.6rem;
}

.account-sidebar-title {
  margin: 0;
  font-size: 0.74rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--soft-ink);
}

.account-sidebar-nav {
  display: grid;
  gap: 0.4rem;
}

.account-nav-link {
  text-decoration: none;
  color: var(--soft-ink);
  padding: 0.35rem 0;
  font-size: 0.85rem;
  transition: color 150ms ease;
}

.account-nav-link:hover {
  color: var(--ink);
}

.account-nav-link.is-active {
  color: color-mix(in srgb, var(--accent) 46%, var(--ink));
  font-weight: 700;
}

.account-content {
  min-height: 0;
}

.settings-card,
.stats-card {
  display: grid;
  gap: 0.9rem;
  min-height: 0;
  padding: 0.2rem 0;
}

.settings-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.7rem;
  padding-bottom: 0.35rem;
  border-bottom: 1px solid color-mix(in srgb, var(--line) 75%, transparent);
}

.settings-header h2 {
  margin: 0;
  font-family: var(--font-heading);
  font-size: 1.45rem;
  font-weight: 600;
}

.stats-section-nav {
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
}

.stats-section-nav button,
.stats-section-nav a {
  min-height: 1.9rem;
}

.settings-grid {
  display: grid;
  gap: 0.6rem;
}

.settings-row {
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto;
  gap: 0.65rem;
  align-items: center;
  padding: 0.55rem 0;
}

.settings-row + .settings-row {
  border-top: 1px solid color-mix(in srgb, var(--line) 65%, transparent);
}

.settings-row label {
  font-size: 0.92rem;
  font-weight: 600;
}

.settings-control {
  display: flex;
  justify-content: flex-end;
}

.settings-control select {
  min-width: 9rem;
  padding: 0.35rem 0;
  border: 0;
  border-bottom: 1px solid color-mix(in srgb, var(--line) 75%, transparent);
  border-radius: 0;
  background: transparent;
  color: var(--ink);
}

:root[data-theme="dark"] .settings-control select {
  color-scheme: dark;
}

.settings-control select option,
.settings-control select optgroup {
  background-color: var(--paper);
  color: var(--ink);
}

.settings-footer {
  padding-top: 0.35rem;
  border-top: 1px solid color-mix(in srgb, var(--line) 75%, transparent);
  display: grid;
  gap: 0.2rem;
}

.settings-reset-confirm {
  display: grid;
  gap: 0.45rem;
}

.settings-reset-actions {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.app-info-inline,
.app-open-source,
.app-storage-status,
.app-update-status {
  margin: 0;
  font-size: 0.8rem;
  color: var(--soft-ink);
}

.stats {
  display: grid;
  gap: 0.75rem;
  min-height: 0;
  overflow: auto;
}

.stats-panel {
  padding: 0.55rem 0;
  display: grid;
  gap: 0.65rem;
}

.stats-panel + .stats-panel {
  border-top: 1px solid color-mix(in srgb, var(--line) 75%, transparent);
  padding-top: 0.85rem;
}

.stats-panel h3 {
  margin: 0;
  font-size: 1.02rem;
  font-family: var(--font-heading);
  font-weight: 600;
}

.stats-kpi-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 0.5rem;
}

.stats-kpi-card {
  margin: 0;
  padding: 0.6rem;
  border: 1px solid color-mix(in srgb, var(--line) 65%, transparent);
  border-radius: 0.5rem;
  background: color-mix(in srgb, var(--surface) 55%, transparent);
  display: grid;
  gap: 0.18rem;
}

.stats-kpi-label {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--soft-ink);
}

.stats-kpi-value {
  font-size: 1.08rem;
  font-weight: 700;
  line-height: 1.2;
  color: var(--ink);
}

.stats-kpi-meta {
  font-size: 0.75rem;
  color: var(--soft-ink);
}

.stats-empty {
  display: grid;
  gap: 0.55rem;
  justify-items: start;
  padding: 0.75rem;
  border: 1px dashed color-mix(in srgb, var(--line-strong) 65%, transparent);
  border-radius: 0.5rem;
  background: color-mix(in srgb, var(--surface-2) 45%, transparent);
}

.stats-empty p {
  margin: 0;
  color: var(--soft-ink);
  font-size: 0.84rem;
}

.stats-empty-copy {
  margin: 0;
  color: var(--soft-ink);
  font-size: 0.8rem;
}

.stats-overview-grid {
  display: grid;
  grid-template-columns: minmax(110px, 130px) minmax(0, 1fr);
  align-items: center;
  gap: 0.8rem;
}

.stats-pie-chart {
  width: min(130px, 100%);
  aspect-ratio: 1 / 1;
  border-radius: 999px;
  display: grid;
  place-items: center;
}

.stats-pie-center {
  width: 64%;
  aspect-ratio: 1 / 1;
  border-radius: 999px;
  display: grid;
  place-items: center;
  background: var(--paper);
  font-weight: 700;
  font-variant-numeric: tabular-nums;
}

.stats-overview-lines {
  display: grid;
  gap: 0.55rem;
}

.stats-pie-legend {
  margin: 0;
  padding: 0;
  list-style: none;
  display: grid;
  gap: 0.35rem;
  font-size: 0.8rem;
}

.stats-pie-legend li {
  display: inline-flex;
  gap: 0.45rem;
  align-items: center;
}

.stats-legend-swatch {
  width: 0.72rem;
  height: 0.72rem;
  border-radius: 0.2rem;
  background: var(--surface-2);
}

.stats-legend-swatch.solved {
  background: color-mix(in srgb, #4cae79 60%, var(--surface));
}

.stats-legend-swatch.unfinished {
  background: var(--surface-3);
}

.stats-bars {
  display: grid;
  gap: 0.6rem;
}

.stats-bar-row {
  display: grid;
  gap: 0.25rem;
}

.stats-bar-head {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: 0.5rem;
}

.stats-bar-title {
  font-size: 0.82rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

.stats-bar-rate {
  font-size: 0.8rem;
  color: var(--soft-ink);
}

.stats-bar-track {
  height: 0.9rem;
  border-radius: 999px;
  background: color-mix(in srgb, var(--line) 35%, transparent);
  overflow: hidden;
}

.stats-bar-fill {
  height: 100%;
  transition: width 150ms ease;
}

.stats-bar-fill-easy {
  background: color-mix(in srgb, #62b4da 70%, var(--surface));
}

.stats-bar-fill-medium {
  background: color-mix(in srgb, #d2a666 70%, var(--surface));
}

.stats-bar-fill-hard {
  background: color-mix(in srgb, #d28d7d 70%, var(--surface));
}

.stats-bar-fill-expert {
  background: color-mix(in srgb, var(--accent) 72%, var(--surface));
}

.stats-bar-line {
  margin: 0;
  font-size: 0.8rem;
  color: var(--soft-ink);
}

.daily-summary-line {
  margin: 0;
  display: flex;
  justify-content: space-between;
  gap: 0.6rem;
  flex-wrap: wrap;
  color: var(--soft-ink);
  font-size: 0.8rem;
}

.daily-calendar-header {
  display: grid;
  grid-template-columns: auto minmax(0, 1fr) auto;
  align-items: center;
  gap: 0.5rem;
}

.daily-calendar-month {
  margin: 0;
  text-align: center;
  font-size: 0.88rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.daily-calendar-weekdays,
.daily-calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, minmax(0, 1fr));
  gap: 0.3rem;
}

.daily-calendar-weekdays {
  color: var(--soft-ink);
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.07em;
}

.daily-calendar-weekdays span {
  text-align: center;
}

.daily-calendar-day {
  min-height: 2.6rem;
  border-radius: 0.45rem;
  background: color-mix(in srgb, var(--surface) 45%, transparent);
  display: grid;
  align-content: space-between;
  justify-items: start;
  padding: 0.28rem;
  transition: background-color 150ms ease;
}

.daily-calendar-day.is-actionable {
  width: 100%;
  border: 1px solid color-mix(in srgb, var(--line) 55%, transparent);
  color: inherit;
  font: inherit;
  text-align: left;
  cursor: pointer;
}

.daily-calendar-day.is-actionable:hover {
  background: color-mix(in srgb, var(--surface-2) 58%, transparent);
  border-color: color-mix(in srgb, var(--line-strong) 70%, transparent);
}

.daily-calendar-day-number {
  font-size: 0.76rem;
  font-weight: 700;
}

.daily-calendar-day-difficulty {
  margin-left: auto;
  font-size: 0.66rem;
  color: var(--soft-ink);
}

.daily-calendar-day.outside-month {
  opacity: 0.45;
}

.daily-calendar-day.won {
  background: color-mix(in srgb, #64b88d 16%, var(--surface));
}

.daily-calendar-day.lost {
  background: color-mix(in srgb, var(--error) 18%, var(--surface));
}

.daily-calendar-day.today {
  background: color-mix(in srgb, var(--accent-soft) 55%, transparent);
}

.daily-calendar-legend {
  display: flex;
  gap: 0.7rem;
  flex-wrap: wrap;
  color: var(--soft-ink);
  font-size: 0.76rem;
}

.daily-calendar-legend span {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
}

.daily-calendar-legend .legend-swatch {
  width: 0.7rem;
  height: 0.7rem;
  border-radius: 0.2rem;
  background: var(--surface-2);
}

.daily-calendar-legend .legend-swatch.won {
  background: color-mix(in srgb, #64b88d 30%, var(--surface));
}

.daily-calendar-legend .legend-swatch.lost {
  background: color-mix(in srgb, var(--error) 30%, var(--surface));
}

.daily-calendar-legend .legend-swatch.today {
  background: color-mix(in srgb, var(--accent-soft) 65%, transparent);
}

.game-loading-card {
  width: min(24rem, 100%);
  padding: 0.9rem;
  background: transparent;
}

.profile-view {
  display: grid;
  gap: 0.75rem;
  overflow-y: auto;
}

.profile-card {
  padding: 0.45rem 0;
  display: grid;
  gap: 0.6rem;
}

.profile-hero-card {
  gap: 0.7rem;
}

.profile-hero {
  display: grid;
  grid-template-columns: auto minmax(0, 1fr);
  gap: 0.75rem;
  align-items: center;
}

.profile-avatar {
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 999px;
  display: grid;
  place-items: center;
  font-family: var(--font-heading);
  font-size: 1.05rem;
  font-weight: 700;
  color: var(--ink);
  border: 1px solid color-mix(in srgb, var(--line) 72%, transparent);
  background: color-mix(in srgb, var(--surface-2) 62%, transparent);
}

.profile-identity {
  display: grid;
  gap: 0.2rem;
}

.profile-display-name {
  margin: 0;
  font-family: var(--font-heading);
  font-size: 1.16rem;
  font-weight: 600;
  line-height: 1.2;
}

.profile-name-row {
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
}

.profile-name-edit-button {
  width: 1.65rem;
  height: 1.65rem;
  border: 1px solid color-mix(in srgb, var(--line) 74%, transparent);
  border-radius: 999px;
  background: transparent;
  color: var(--soft-ink);
  display: grid;
  place-items: center;
  cursor: pointer;
  transition: border-color 150ms ease, color 150ms ease, background-color 150ms ease;
}

.profile-name-edit-button:hover {
  color: var(--ink);
  border-color: color-mix(in srgb, var(--line-strong) 72%, transparent);
  background: color-mix(in srgb, var(--surface-2) 50%, transparent);
}

.profile-name-edit-button:disabled {
  opacity: 0.5;
  cursor: default;
}

.profile-npub-row {
  margin: 0;
  display: grid;
  gap: 0.15rem;
}

.profile-empty-state {
  padding: 0.65rem 0;
}

.profile-card + .profile-card {
  border-top: 1px solid color-mix(in srgb, var(--line) 75%, transparent);
  padding-top: 0.8rem;
}

.profile-card h2,
.profile-card p,
.profile-card label {
  margin: 0;
}

.profile-helper,
.profile-secret-warning,
.profile-status,
.profile-error {
  font-size: 0.84rem;
  color: var(--soft-ink);
}

.profile-warning,
.profile-error {
  color: var(--error);
}

.profile-meta,
.profile-restore-confirm,
.profile-secret-key {
  padding: 0.2rem 0;
  background: transparent;
}

.profile-meta {
  display: grid;
  gap: 0.45rem;
}

.profile-meta-row {
  display: grid;
  gap: 0.15rem;
}

.profile-meta-label {
  color: var(--soft-ink);
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.profile-mono {
  font-family: ui-monospace, "SFMono-Regular", Menlo, Consolas, "Liberation Mono", monospace;
  font-size: 0.76rem;
  overflow-wrap: anywhere;
}

.profile-actions {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.profile-actions button {
  min-height: 2.3rem;
}

.profile-auth-dialog {
  max-height: min(85vh, 42rem);
  overflow-y: auto;
}

.profile-auth-section {
  display: grid;
  gap: 0.55rem;
}

.profile-auth-section + .profile-auth-section {
  border-top: 1px solid color-mix(in srgb, var(--line) 70%, transparent);
  padding-top: 0.75rem;
}

.profile-auth-section h3 {
  margin: 0;
  font-size: 1rem;
  font-family: var(--font-heading);
  font-weight: 600;
}

.profile-disclosure {
  margin: 0;
  padding: 0;
  border: 0;
  background: transparent;
}

.profile-disclosure summary {
  cursor: pointer;
  font-weight: 600;
  color: var(--ink);
}

.profile-disclosure-content {
  margin-top: 0.55rem;
  display: grid;
  gap: 0.55rem;
}

.profile-disclosure-content h3 {
  margin: 0;
  font-size: 0.82rem;
  text-transform: uppercase;
  letter-spacing: 0.07em;
  color: var(--soft-ink);
}

.profile-info-list {
  margin: 0;
  padding-left: 1rem;
  display: grid;
  gap: 0.35rem;
  font-size: 0.84rem;
}

.profile-card input {
  width: 100%;
  border: 0;
  border-bottom: 1px solid color-mix(in srgb, var(--line) 75%, transparent);
  border-radius: 0;
  background: transparent;
  color: var(--ink);
  padding: 0.35rem 0;
}

.profile-auth-dialog input {
  width: 100%;
  border: 0;
  border-bottom: 1px solid color-mix(in srgb, var(--line) 75%, transparent);
  border-radius: 0;
  background: transparent;
  color: var(--ink);
  padding: 0.35rem 0;
}

.profile-card button:not([class]),
.profile-auth-dialog button:not([class]),
.settings-header button:not([class]),
.daily-calendar-header button:not([class]),
.home-view button:not([class]),
.panel-view button:not([class]) {
  border: 1px solid color-mix(in srgb, var(--line) 78%, transparent);
  border-radius: 0.45rem;
  background: transparent;
  color: var(--ink);
  padding: 0.45rem 0.7rem;
  font: inherit;
  transition: border-color 150ms ease, background-color 150ms ease, color 150ms ease;
}

.profile-card button:not([class]):hover,
.profile-auth-dialog button:not([class]):hover,
.settings-header button:not([class]):hover,
.daily-calendar-header button:not([class]):hover,
.home-view button:not([class]):hover,
.panel-view button:not([class]):hover {
  background: color-mix(in srgb, var(--surface-2) 55%, transparent);
  border-color: color-mix(in srgb, var(--line-strong) 75%, transparent);
  color: color-mix(in srgb, var(--accent) 45%, var(--ink));
}

.profile-card button:not([class]):disabled,
.profile-auth-dialog button:not([class]):disabled,
.settings-header button:not([class]):disabled,
.daily-calendar-header button:not([class]):disabled,
.home-view button:not([class]):disabled,
.panel-view button:not([class]):disabled {
  opacity: 0.52;
}

.win-modal {
  width: min(22rem, calc(100vw - 1.25rem));
  border: 0;
  border-radius: 0.4rem;
  background: var(--paper);
  color: var(--ink);
}

.win-modal::backdrop {
  background: #00000066;
}

.win-card {
  padding: 1rem;
  display: grid;
  gap: 0.5rem;
}

.win-card h2,
.win-card p {
  margin: 0;
}

.win-actions {
  margin-top: 0.3rem;
  display: grid;
  gap: 0.45rem;
}

.win-actions button {
  width: 100%;
  border: 1px solid color-mix(in srgb, var(--line) 78%, transparent);
  border-radius: 0.45rem;
  background: transparent;
  color: var(--ink);
  padding: 0.45rem 0.7rem;
}

@media (max-width: 920px) {
  .app.app-home,
  .app.app-panel,
  .app.app-game {
    padding: 0.75rem;
  }

  .home-view,
  .panel-view,
  .settings-card,
  .stats-card {
    padding: 0.8rem;
  }

  .settings-row {
    grid-template-columns: 1fr;
  }

  .settings-header {
    flex-wrap: wrap;
  }

  .settings-control {
    justify-content: flex-start;
  }

  .stats-overview-grid {
    grid-template-columns: 1fr;
    justify-items: center;
  }

  .stats-kpi-grid {
    grid-template-columns: 1fr;
  }

  .stats-overview-lines {
    width: 100%;
  }

  .lives {
    padding: 0.32rem 0.2rem;
  }

  .numpad {
    gap: 0.28rem;
    padding-bottom: max(0.25rem, env(safe-area-inset-bottom));
  }

  .account-sidebar-nav {
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 0.35rem;
  }

  .account-nav-link {
    text-align: center;
    font-size: 0.76rem;
    line-height: 1.25;
    padding: 0.45rem;
  }
}

@media (max-width: 1023px) {
  .game-rail-left {
    display: grid;
    grid-template-columns: auto auto minmax(0, 1fr) auto auto;
    align-items: center;
    column-gap: 0.28rem;
    width: 100%;
    max-width: 33rem;
    height: auto;
  }

  .game-rail-left #undo {
    grid-column: 1;
    justify-self: start;
  }

  .game-rail-left #redo {
    grid-column: 2;
    justify-self: start;
  }

  .game-rail-left #lives {
    grid-column: 3;
    width: auto;
    min-width: 2rem;
    justify-self: center;
    margin-block: 0;
  }

  .game-rail-left #annotation-mode {
    grid-column: 4;
    justify-self: end;
  }

  .game-rail-left #hint {
    grid-column: 5;
    justify-self: end;
  }

  .game-rail-left #lives-display {
    flex-direction: row;
    gap: 0.08rem;
  }
}

@media (min-width: 1024px) {
  .app.app-game {
    max-width: 64rem;
  }

  .game-layout {
    max-width: none;
    margin: 0;
    display: grid;
    grid-template-columns: minmax(8.25rem, 10rem) minmax(0, 33rem) minmax(8.25rem, 10rem);
    column-gap: 0.35rem;
    justify-content: center;
    align-items: start;
  }

  .game-center,
  .game-rail-left,
  .game-rail-right {
    order: 0;
  }

  .game-rail-left {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 2rem;
    max-width: 2rem;
    height: 33rem;
    justify-self: end;
  }

  .game-rail-left #lives {
    margin-block: auto;
  }

  .game-rail-right {
    grid-template-columns: 1fr;
    justify-self: start;
  }

  .game-secondary-actions {
    grid-template-columns: 1fr;
  }

  .game-rail-right .difficulty-segment {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .game-center {
    width: 33rem;
    justify-self: center;
  }

  .account-layout {
    grid-template-columns: minmax(11rem, 13rem) minmax(0, 1fr);
    align-items: start;
  }

  .account-sidebar {
    position: sticky;
    top: calc(env(safe-area-inset-top) + 4.5rem);
  }
}

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 1ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 1ms !important;
    scroll-behavior: auto !important;
  }
}
